<ul class="space-y-8">
  <% @support_requests.each do |support_request| %>
    <li class="p-6 bg-white rounded-lg shadow-md border">
      <header class="mb-4">
        <h1 class="text-lg font-semibold">
          On <%= support_request.created_at.to_formatted_s(:long) %>,
          <code class="text-blue-700"><%= support_request.email %></code> wrote:
        </h1>
      </header>

      <blockquote class="pl-4 border-l-4 border-blue-300 mb-4">
        <h2 class="text-xl font-bold mb-2"><%= support_request.subject %></h2>
        <p class="text-gray-800"><%= support_request.body %></p>
      </blockquote>

      <% if support_request.order %>
        <section class="mb-4">
          <h3 class="text-md font-semibold text-blue-600 mb-2">Recent Order</h3>
          <dl class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2 text-sm">
            <dt class="font-medium text-gray-600">Name</dt>
            <dd class="text-gray-900"><%= support_request.order.name %></dd>

            <dt class="font-medium text-gray-600">Email</dt>
            <dd class="text-gray-900"><%= support_request.order.email %></dd>

            <dt class="font-medium text-gray-600">Address</dt>
            <dd class="text-gray-900"><%= support_request.order.address %></dd>

            <dt class="font-medium text-gray-600">Pay Type</dt>
            <dd class="text-gray-900"><%= support_request.order.pay_type %></dd>
          </dl>

          <div class="mt-4">
            <h4 class="text-sm font-semibold text-gray-700 mb-1">Line Items</h4>
            <ul class="list-disc list-inside text-gray-800">
              <% support_request.order.line_items.each do |line_item| %>
                <li>
                  <%= line_item.product.title %> (<%= number_to_currency(line_item.product.price) %>)
                </li>
              <% end %>
            </ul>
          </div>
        </section>
      <% else %>
        <p class="text-red-500 font-medium">No associated order</p>
      <% end %>

      <% if support_request.response.blank? %>
        <section class="mt-6">
          <%= form_with(model: support_request, local: true, class: "space-y-4") do |form| %>
            <div class="field">
              <%= form.label :response, "Write Response", class: "block font-medium mb-1" %>
              <%= form.rich_text_area :response, id: :support_request_response, class: "w-full border border-gray-300 rounded-md" %>
            </div>
            <div class="text-center">
              <%= form.submit "Send Response", class: "inline-block bg-blue-600 text-white font-medium rounded-md px-4 py-2 hover:bg-blue-500" %>
            </div>
          <% end %>
        </section>
      <% else %>
        <section class="mt-6 bg-gray-50 border border-gray-200 p-4 rounded-md">
          <h4 class="font-semibold text-gray-700 mb-2">Our response:</h4>
          <blockquote class="pl-4 border-l-4 border-green-400 text-gray-800">
            <%= support_request.response %>
          </blockquote>
        </section>
      <% end %>

      <hr class="mt-6">
    </li>
  <% end %>
</ul>
